# GitHub Secrets Configuration Guide
# Task: T5.6.1 - CI/CD Pipeline GitHub Secrets Setup
# Generated by: cicd-monitoring-agent
# Reference: phase5-spec.md Section 6.1, constitution.md Section 6

## Overview

This document provides instructions for configuring GitHub Secrets required for the CI/CD pipeline to function properly. All secrets must be configured in your GitHub repository settings before running the deployment workflows.

## Required GitHub Secrets

### 1. Docker Hub Credentials

**Purpose**: Push Docker images to Docker Hub registry

- **DOCKER_USERNAME**
  - Description: Your Docker Hub username
  - Example: `myusername`
  - How to get: Sign up at https://hub.docker.com/

- **DOCKER_PASSWORD**
  - Description: Your Docker Hub password or access token (recommended)
  - How to get:
    1. Go to https://hub.docker.com/settings/security
    2. Click "New Access Token"
    3. Give it a name (e.g., "GitHub Actions")
    4. Copy the token (you won't see it again)

### 2. Kubernetes Cluster Configuration

**Purpose**: Deploy applications to Kubernetes clusters

- **KUBECONFIG_STAGING**
  - Description: Base64-encoded kubeconfig file for staging cluster
  - How to get:
    ```bash
    # Get your kubeconfig
    kubectl config view --flatten --minify > staging-kubeconfig.yaml

    # Base64 encode it
    cat staging-kubeconfig.yaml | base64 -w 0

    # Copy the output and paste as secret value
    ```

- **KUBECONFIG_PRODUCTION**
  - Description: Base64-encoded kubeconfig file for production cluster
  - How to get: Same as staging, but for production cluster

### 3. Azure Credentials (if using Azure AKS)

**Purpose**: Authenticate with Azure services

- **AZURE_CREDENTIALS**
  - Description: Azure service principal credentials in JSON format
  - How to get:
    ```bash
    # Create service principal
    az ad sp create-for-rbac --name "github-actions-sp" \
      --role contributor \
      --scopes /subscriptions/{subscription-id}/resourceGroups/{resource-group} \
      --sdk-auth

    # Copy the entire JSON output
    ```
  - Example format:
    ```json
    {
      "clientId": "xxx",
      "clientSecret": "xxx",
      "subscriptionId": "xxx",
      "tenantId": "xxx"
    }
    ```

### 4. Google Cloud Credentials (if using Google GKE)

**Purpose**: Authenticate with Google Cloud services

- **GCP_CREDENTIALS**
  - Description: Google Cloud service account key in JSON format
  - How to get:
    ```bash
    # Create service account
    gcloud iam service-accounts create github-actions-sa \
      --display-name="GitHub Actions Service Account"

    # Grant necessary roles
    gcloud projects add-iam-policy-binding {project-id} \
      --member="serviceAccount:github-actions-sa@{project-id}.iam.gserviceaccount.com" \
      --role="roles/container.developer"

    # Create and download key
    gcloud iam service-accounts keys create key.json \
      --iam-account=github-actions-sa@{project-id}.iam.gserviceaccount.com

    # Copy the contents of key.json
    cat key.json
    ```

### 5. Database Credentials (Optional)

**Purpose**: Connect to external databases

- **DATABASE_URL**
  - Description: PostgreSQL connection string
  - Example: `postgresql://user:password@host:5432/dbname`

- **REDIS_URL**
  - Description: Redis connection string
  - Example: `redis://host:6379`

### 6. API Keys (Optional)

**Purpose**: Third-party service integrations

- **OPENAI_API_KEY**
  - Description: OpenAI API key for AI chatbot features
  - How to get: https://platform.openai.com/api-keys

- **CODECOV_TOKEN**
  - Description: Codecov token for code coverage reporting
  - How to get: https://codecov.io/

### 7. Notification Webhooks (Optional)

**Purpose**: Send deployment notifications

- **SLACK_WEBHOOK_URL**
  - Description: Slack webhook URL for notifications
  - How to get: https://api.slack.com/messaging/webhooks

- **DISCORD_WEBHOOK_URL**
  - Description: Discord webhook URL for notifications
  - How to get: Server Settings → Integrations → Webhooks

## How to Add Secrets to GitHub

### Via GitHub Web Interface

1. Go to your repository on GitHub
2. Click on "Settings" tab
3. In the left sidebar, click "Secrets and variables" → "Actions"
4. Click "New repository secret"
5. Enter the secret name (e.g., `DOCKER_USERNAME`)
6. Enter the secret value
7. Click "Add secret"
8. Repeat for all required secrets

### Via GitHub CLI

```bash
# Install GitHub CLI if not already installed
# https://cli.github.com/

# Authenticate
gh auth login

# Add secrets
gh secret set DOCKER_USERNAME --body "your-username"
gh secret set DOCKER_PASSWORD --body "your-password"

# Add secrets from file
gh secret set KUBECONFIG_STAGING < staging-kubeconfig-base64.txt
gh secret set AZURE_CREDENTIALS < azure-credentials.json
```

## Environment-Specific Secrets

GitHub Actions supports environment-specific secrets. You can configure different secrets for staging and production environments.

### Setting Up Environments

1. Go to repository Settings → Environments
2. Click "New environment"
3. Name it "staging" or "production"
4. Add environment-specific secrets
5. Configure protection rules (e.g., required reviewers for production)

### Environment Secrets

For each environment (staging, production), you can set:

- `KUBECONFIG` - Environment-specific kubeconfig
- `DATABASE_URL` - Environment-specific database URL
- `API_KEYS` - Environment-specific API keys

## Verification

After adding all secrets, verify they are configured correctly:

```bash
# List all secrets (values are hidden)
gh secret list

# Test the workflow
git push origin main
```

## Security Best Practices

1. **Never commit secrets to git**
   - Add sensitive files to `.gitignore`
   - Use `.env.example` for documentation, not `.env`

2. **Use access tokens instead of passwords**
   - Docker Hub: Use access tokens
   - GitHub: Use personal access tokens with minimal scopes

3. **Rotate secrets regularly**
   - Change passwords/tokens every 90 days
   - Update GitHub secrets after rotation

4. **Use environment protection rules**
   - Require manual approval for production deployments
   - Limit who can approve production deployments

5. **Audit secret usage**
   - Review workflow logs regularly
   - Monitor for unauthorized access attempts

6. **Use least privilege principle**
   - Grant only necessary permissions to service accounts
   - Use separate credentials for staging and production

## Troubleshooting

### Secret Not Found Error

```
Error: Secret DOCKER_USERNAME not found
```

**Solution**: Verify the secret name matches exactly (case-sensitive)

### Invalid Kubeconfig

```
Error: Unable to connect to cluster
```

**Solution**:
1. Verify kubeconfig is base64-encoded correctly
2. Check cluster endpoint is accessible from GitHub Actions runners
3. Verify service account has necessary permissions

### Docker Login Failed

```
Error: Login failed
```

**Solution**:
1. Verify Docker Hub credentials are correct
2. Use access token instead of password
3. Check if 2FA is enabled (use token)

### Azure/GCP Authentication Failed

```
Error: Authentication failed
```

**Solution**:
1. Verify service principal/service account has correct permissions
2. Check JSON format is valid
3. Ensure subscription/project ID is correct

## Additional Resources

- [GitHub Actions Secrets Documentation](https://docs.github.com/en/actions/security-guides/encrypted-secrets)
- [Docker Hub Access Tokens](https://docs.docker.com/docker-hub/access-tokens/)
- [Azure Service Principals](https://docs.microsoft.com/en-us/azure/active-directory/develop/howto-create-service-principal-portal)
- [GCP Service Accounts](https://cloud.google.com/iam/docs/service-accounts)
- [Kubernetes RBAC](https://kubernetes.io/docs/reference/access-authn-authz/rbac/)

## Support

If you encounter issues with secret configuration:

1. Check GitHub Actions workflow logs
2. Verify secret names match workflow file
3. Test credentials locally before adding to GitHub
4. Review this documentation for common issues
5. Contact DevOps team for assistance

---

**Last Updated**: 2026-02-15
**Version**: 1.0
**Maintained by**: cicd-monitoring-agent
